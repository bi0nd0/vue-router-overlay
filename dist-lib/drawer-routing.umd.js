(function(e,p){typeof exports=="object"&&typeof module<"u"?module.exports=p(require("vue"),require("vue-router")):typeof define=="function"&&define.amd?define(["vue","vue-router"],p):(e=typeof globalThis<"u"?globalThis:e||self,e.DrawerRoutingPlugin=p(e.Vue,e.VueRouter))})(this,function(e,p){"use strict";const y={__name:"MainRouterView",setup(o){const s=p.useRouter(),t=()=>n.baseRoute||s.currentRoute.value,r=e.computed(()=>{if(n.isOpen&&n.baseRoute){const d=n.baseRoute,a=[...d.matched].filter(c=>{var l;return((l=c.meta)==null?void 0:l.overlay)!==!0});return{...d,matched:a}}return t()}),i=e.computed(()=>r.value.fullPath);return(d,a)=>(e.openBlock(),e.createBlock(e.unref(p.RouterView),{key:i.value,route:r.value},null,8,["route"]))}},f={__name:"OverlayRouterView",props:{filterMatchedRoutes:{type:Function,default:o=>o.filter(s=>{var t;return((t=s.meta)==null?void 0:t.overlay)===!0})}},setup(o){const s=p.useRouter(),t=e.computed(()=>n.isOpen),r=o,i=e.computed(()=>{if(!n.overlayRoute)return null;const c=r.filterMatchedRoutes([...n.overlayRoute.matched]);return{...n.overlayRoute,matched:c}});function d(c){c.key==="Escape"&&t.value&&a()}const a=()=>{console.log("closing drawer"),n.baseRoute&&s.push(n.baseRoute)};return e.onMounted(()=>{window.addEventListener("keydown",d)}),e.onBeforeUnmount(()=>{window.removeEventListener("keydown",d)}),(c,l)=>i.value?(e.openBlock(),e.createBlock(e.unref(p.RouterView),{key:0,route:i.value},{default:e.withCtx(u=>[e.renderSlot(c.$slots,"default",e.normalizeProps(e.guardReactiveProps({...u,isOpen:t.value,closeOverlay:a})),()=>[(e.openBlock(),e.createBlock(e.resolveDynamicComponent(u.Component),{"close-overlay":a,"is-open":t.value},null,8,["is-open"]))])]),_:3},8,["route"])):e.createCommentVNode("",!0)}},h=(o,s)=>{const t=o.__vccOpts||o;for(const[r,i]of s)t[r]=i;return t},R={key:0,class:"drawer-container"},_={class:"drawer-header"},w={class:"drawer-content"},k=h({__name:"Drawer",props:{width:{type:String,default:"400px"},position:{type:String,default:"right"},isOpen:{type:Boolean,default:!1}},emits:["hide"],setup(o,{emit:s}){const t=o,{isOpen:r}=e.toRefs(t),i=s;function d(){setTimeout(()=>{console.log("hiding"),i("hide")},0)}const a=e.computed(()=>({width:t.width,[t.position]:r.value?"0":`-${t.width}`}));return(c,l)=>{var u;return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createTextVNode(e.toDisplayString(e.unref(r)?"yes":"no")+" ",1),e.unref(r)?(e.openBlock(),e.createElementBlock("div",R,[e.createElementVNode("div",{class:"drawer-backdrop",onClick:d}),e.createElementVNode("div",{class:"drawer",style:e.normalizeStyle(a.value)},[e.createElementVNode("div",_,[e.createElementVNode("div",null,[e.createElementVNode("span",null,e.toDisplayString(((u=e.unref(n).overlayRoute.meta)==null?void 0:u.title)??""),1)]),e.createElementVNode("button",{class:"drawer-close",onClick:d},"Ã—")]),e.createElementVNode("div",w,[l[0]||(l[0]=e.createElementVNode("div",null,"asdasdsa",-1)),e.renderSlot(c.$slots,"default",{},void 0,!0)])],4)])):e.createCommentVNode("",!0)],64)}}},[["__scopeId","data-v-3aad5920"]]),O={__name:"DrawerRouterView",setup(o){return(s,t)=>(e.openBlock(),e.createBlock(f,null,{default:e.withCtx(({isOpen:r,Component:i,closeOverlay:d})=>[e.createVNode(k,{"is-open":r,onHide:d},{default:e.withCtx(()=>[(e.openBlock(),e.createBlock(e.resolveDynamicComponent(i)))]),_:2},1032,["is-open","onHide"])]),_:1}))}},n=e.reactive({isOpen:!1,baseRoute:null,overlayRoute:null});function V(){const o=new Set;let s=null;return{install(t,{router:r}){t.component("MainRouterView",y),t.component("OverlayRouterView",f),t.component("DrawerRouterView",O);const i=(a,c="")=>{a.forEach(l=>{var m;const u=c+(l.path.startsWith("/")?l.path:`/${l.path}`);(m=l.meta)!=null&&m.overlay&&o.add(l.name||u),l.children&&i(l.children,u)})};i(r.getRoutes());const d=a=>a.name===void 0&&a.matched.length===0;r.beforeEach((a,c,l)=>{if(g(a,o)){if(d(c)){s=a.fullPath,l({path:"/",replace:!0});return}n.isOpen||(n.baseRoute=e.markRaw(c),n.isOpen=!0),n.overlayRoute=e.markRaw(a),l()}else n.isOpen?n.isOpen=!1:(n.overlayRoute=null,n.baseRoute=null),l()}),r.afterEach(()=>{s&&(r.push(s),s=null)}),t.provide("overlayRouter",{state:n,isOverlayRoute:a=>o.has(a),isOverlayActive:()=>n.isOpen})}}}function g(o,s){var t;return!!((t=o.meta)!=null&&t.overlay||o.name&&s.has(o.name)||o.matched&&o.matched.some(r=>{var i;return(i=r.meta)==null?void 0:i.overlay}))}return V});
